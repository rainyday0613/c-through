<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<canvas id="c"></canvas>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="module">
    //  three.js 위치 import 하기
    import * as THREE from 'https://threejsfundamentals.org/threejs/resources/threejs/r119/build/three.module.js';

    //  그려줄 위치 설정하기
    const canvas = document.querySelector('#c');
    const renderer = new THREE.WebGLRenderer({canvas});
    renderer.setSize (window.innerWidth, window.innerHeight);

    const fov = 536;
    const aspect = 2;  // the canvas default
    const near = 0.1;
    const far = 0;
    let r = 0.0;
    let theta = 0.0;
    let arr;
    let cube = new Array();
    let rs_array = new Array();
    let material;
    let geometry;
    //  카메라 보이는 크기 설정하기
    const camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
    //  카메라 위치 설정하기
    camera.position.z = 1
    //  좌표계 설정
    const scene = new THREE.Scene();
    //  배경색 설정
    scene.background = new THREE.Color( 0xff00ff);
    //  실행하기
    setInterval(recy,1000)
    //  점 찍기
    function recy () {
        axios.get('http://localhost:1234/lidartest').then(res => {
            rs_array = res.data
            console.log(rs_array.length)
            console.log(rs_array[0][1])
        })

        for(let i = 0; i < rs_array.length; i = i + 1)
        {
            r = rs_array[i][0]
            theta = rs_array[i][1]
            let x = r * Math.cos( theta )
            let y = r * Math.sin( theta )
            arr = cube[rs_array[i][1]*100000]
            //  한변의 길이
            const radius = 0.5;
            //  segments 각형( 최소 3각형)
            const segments = 3;
            //  무엇으로 그려줄 지 설정히기
            geometry = new THREE.CircleBufferGeometry(radius, segments);
            //  그려줄 것 색 설정히기
            material = new THREE.MeshBasicMaterial({ color: 0x000088 })
            //  색가 그릴 것을 합쳐주기
            arr = new THREE.Mesh(geometry, material)
            //  중심에서부터 x 축으로 옮겨주기
            arr.position.x = x;
            //  중심에서부터 y 축으로 옮겨주기
            arr.position.y = y;
            //  좌표계에다가 그려주기
            scene.add(arr)
        }

        //  그려준거 삭제하기
        for(let j = 0; j<rs_array.length; j++)
        {
            arr = cube[rs_array[j][1]*100000];
            scene.remove(cube[rs_array[j][1]*100000])
            arr.geometry.dispose();
            arr.material.dispose();
            arr = undefined;
        }

        renderer.render(scene, camera)

    }
</script>
<style>
    canvas {
        border: 1px solid blue;
        height: 870px;
        width: 1900px;
    }
</style>
</body>
</html>
